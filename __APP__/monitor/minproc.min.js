var e = require("../@babel/runtime/helpers/typeof"), n = function n(r) {
    switch (e(r)) {
      case "object":
        if (!r) return "null";
        if (r instanceof Array) {
            for (var t = "[", a = 0; a < r.length; a++) t += (0 < a ? "," : "") + n(r[a]);
            return t + "]";
        }
        for (var o in t = "{", a = 0, r) if ("function" != typeof r[o]) {
            var c = n(r[o]);
            t += (0 < a ? "," : "") + n(o) + ":" + c, a++;
        }
        return t + "}";

      case "string":
        return '"' + r.replace(/([\"\\])/g, "\\$1").replace(/\r/g, "\\r").replace(/\n/g, "\\n") + '"';

      case "number":
        return r.toString();

      case "boolean":
        return r ? "true" : "false";

      case "function":
        return n(r.toString());

      case "undefined":
      default:
        return '"undefined"';
    }
};

function r() {
    return +new Date();
}

var t = function() {
    function e(e) {
        return e < 0 ? NaN : e <= 30 ? 0 | Math.random() * (1 << e) : e <= 53 ? (0 | Math.random() * (1 << 30)) + (0 | Math.random() * (1 << e - 30)) * (1 << 30) : NaN;
    }
    function n(e, n) {
        for (var r = e.toString(16), t = n - r.length, a = "0"; 0 < t; t >>>= 1, a += a) 1 & t && (r = a + r);
        return r;
    }
    return function() {
        return n(e(32), 8) + "-" + n(e(16), 4) + "-" + n(16384 | e(12), 4) + "-" + n(32768 | e(14), 4) + "-" + n(e(48), 12);
    };
}();

var a = [];

var o = {
    networkType: "",
    system: {}
};

function c(e) {
    return function(n) {
        return "Array" === e && Array.isArray ? Array.isArray(n) : Object.prototype.toString.call(n) === "[object " + e + "]";
    };
}

c("String");

var i = c("Function"), u = c("Object");

function s(e, n) {
    if (u(e) && i(e.handler)) {
        var r = e.name, t = e.handler;
        n[r] = function(e, n) {
            return function() {
                i(n) && n.apply(this, arguments), i(e) && e.apply(this, arguments);
            };
        }(n[r], t);
    }
}

function f() {
    var e = (getCurrentPages() || []).map(function(e) {
        return e.route;
    });
    return 0 < e.length ? e[e.length - 1] : "";
}

var l = {}, h = {}, d = [], p = [], v = [], m = [], g = !1, y = {};

function w(e) {
    g = e;
}

var b = {};

var x = 1, S = !1;

wx.onNetworkStatusChange(function(e) {
    o.networkType = e.networkType;
}), o.system = wx.getSystemInfoSync();

var _ = {
    config: function(e) {
        var n = e.beacon;
        (!n || "https:/" !== n.substring(0, 7) && "http://" !== n.substring(0, 7)) && (e.beacon = "https://" + e.beacon), 
        (b = e || {}).uid = function() {
            var e = wx.getStorageSync("WISEAPM_UID");
            if (!e) {
                e = t();
                try {
                    wx.setStorageSync("WISEAPM_UID", e);
                } catch (e) {}
            }
            return e;
        }(), b.beacon && wx.request({
            url: b.beacon + "/xcx_config/v1.7.0/" + b.id + ".js",
            method: "GET",
            _no_record: !0,
            success: function(e) {
                b.statmainid = e.data.statmainid, b.switch = e.data.switch;
            },
            fail: function() {},
            complete: function() {}
        });
    },
    api: {
        log: function(e, n, r, t) {
            if (e) {
                var a = {
                    k: e,
                    d: n || "",
                    m: r || "",
                    c: t || ""
                };
                v.push(a);
            }
        },
        customError: function(e) {
            if (e) {
                var n = e.message || "", t = e.stack || "", a = r();
                if (t) var o = P(t);
                var c = {
                    e: n,
                    s: t,
                    r: o.fileurl,
                    l: o.lineno,
                    c: o.colno,
                    o: a
                };
                p.push(c);
            }
        }
    }
};

function q() {
    if (console.log(123), S && !g && 1 == b.switch) {
        o.performance = l;
        var e = t(), a = Object.assign({}, {
            path: f(),
            errs: d.slice(),
            fromPath: y.prev || ""
        }), c = {
            ns: r(),
            f: 0,
            ds: 0,
            de: 0,
            cs: 0,
            ce: 0,
            qs: 0,
            rs: 0,
            re: 0,
            ol: 0,
            oi: 0,
            os: 0,
            oe: 0,
            oc: 0,
            ls: 0,
            le: 0,
            tus: 0,
            tue: 0,
            je: d.length,
            bl: 0,
            sh: o.system.screenHeight,
            sw: o.system.screenWidth,
            fs: 0,
            sp: 0
        };
        l = {}, d = [], w(!0);
        var i = wx.getStorageSync("WISEAPM_UID");
        b.uid = i;
        var u = "?av=4.7.5&v=2.2.0&key=" + b.key + "&ref=https%3a%2f%2fmp.weixin.qq.com%2f" + a.path + "&referer=&base=&rand=" + r() + "&pvid=" + e + "&aid=" + b.id + "&if=0&uid=" + b.uid + "&prev=" + (a.fromPath ? "https%3a%2f%2fmp.weixin.qq.com%2f" + a.fromPath : ""), s = b.beacon + "/pf" + u;
        for (var h in c) s += "&" + h + "=" + c[h];
        wx.request({
            url: s,
            data: n({
                chartset: "utf-8",
                tt: "title",
                res: [],
                xp: o
            }),
            method: "POST",
            _no_record: !0
        });
        var x = b.beacon + "/xp" + u + "&statmainid=" + b.statmainid;
        if (wx.request({
            url: x,
            data: n(o),
            method: "POST",
            _no_record: !0,
            success: function() {}
        }), a.errs && a.errs.length > 0) {
            var _ = b.beacon + "/er" + u;
            wx.request({
                url: _,
                data: n({
                    err: a.errs,
                    xp: o
                }),
                method: "POST",
                _no_record: !0,
                success: function() {
                    d.length = 0;
                }
            });
        }
        if (m && m.length > 0) {
            var q = b.beacon + "/as" + u;
            (function(e, n) {
                for (var r = [], t = 0; t < e.length; ) r.push(e.slice(t, t += n));
                return r;
            })(m, 10).forEach(function(e) {
                wx.request({
                    url: q,
                    data: n({
                        xhr: e,
                        xp: o
                    }),
                    method: "POST",
                    _no_record: !0,
                    success: function() {
                        m.length = 0;
                    }
                });
            });
        }
        if (v && v.length > 0) {
            var P = b.beacon + "/cp" + u;
            wx.request({
                url: P,
                data: n({
                    pd: v,
                    xp: o
                }),
                method: "POST",
                _no_record: !0,
                success: function() {
                    v.length = 0;
                }
            });
        }
        if (p && p.length > 0) {
            var O = b.beacon + "/de" + u;
            wx.request({
                url: O,
                data: n({
                    derr: p,
                    xp: o
                }),
                method: "POST",
                _no_record: !0,
                success: function() {
                    p.length = 0;
                }
            });
        }
    }
}

function P(e) {
    var n = e.split(/\n/), r = n[2] || "", t = "", a = 0, o = 0;
    return n.every(function(e) {
        var n = e && e.trim();
        if (0 === n.indexOf("at ")) {
            var r = n.indexOf("("), c = n.indexOf(")");
            if (r && c) {
                var i = r + 1;
                c < i && (i = c);
                var u = n.substring(i, c);
                if (u) {
                    var s = u.split(":");
                    s && 2 < s.length && (t = (s.slice(0, s.length - 2) || []).join(":"), a = +s[s.length - 2], 
                    o = +s[s.length - 1]);
                }
                return !1;
            }
        }
        return !0;
    }), {
        msg: r,
        fileurl: t,
        lineno: a,
        colno: o
    };
}

var O = [ {
    name: "onLaunch",
    handler: function(e) {
        h.onLaunch = r(), function() {
            x = b.sampleRate || 1;
            var e = Math.random();
            S = e <= x;
        }();
        var n = e.path, t = e.query, a = e.scene;
        o.openPath = n, o.query = t, o.scene = a, wx.getNetworkType({
            success: function(e) {
                o.networkType = e.networkType;
            },
            complete: function() {}
        });
    }
}, {
    name: "onError",
    handler: function(e) {
        if (e) {
            var n = P(e);
            n.fileurl || (n.fileurl = f()), d.push({
                f: "",
                fv: "",
                m: "",
                rl: "",
                rvid: "",
                e: n.msg,
                r: n.fileurl,
                ec: 1,
                ep: 1,
                l: n.lineno,
                o: 0,
                c: n.colno,
                s: e
            });
        }
    }
}, {
    name: "onHide",
    handler: function() {
        a = [], y.prev = "", y.current = "";
    }
} ];

var T = [ {
    name: "onLoad",
    handler: function() {
        l.onLoad = r();
    }
}, {
    name: "onShow",
    handler: function() {
        var e;
        l.onShow = r(), e = this.route, a.push(e), y.prev = y.current, y.current = this.route, 
        w(!1);
    }
}, {
    name: "onReady",
    handler: function() {
        l.onReady = r();
    }
}, {
    name: "onHide",
    handler: function() {
        l.onHide = r(), q();
    }
}, {
    name: "onUnload",
    handler: function() {
        l.onUnload = r(), q();
    }
} ];

function k() {
    var e = Page;
    Page = function(n) {
        T.forEach(function(e) {
            s(e, n);
        }), e && e.call(this, n);
    };
    var n = Component;
    Component = function(e) {
        e = function(e) {
            return e.methods || (e.methods = {}), T.forEach(function(n) {
                s(n, e.methods);
            }), e;
        }(e), n && n.call(this, e);
    };
}

var A, E = (A = App, App = function(e) {
    O.forEach(function(n) {
        s(n, e);
    }), A && A.call(this, e);
}, k(), function() {
    var e = wx.request;
    Object.defineProperty(wx, "request", {
        configurable: !0,
        enumerable: !0,
        writable: !0,
        value: function() {
            var t = arguments[0] || {};
            if (!t._no_record) {
                var a, o, c, u, s;
                t.header = t.header || {}, i(t.success) && (c = t.success), i(t.fail) && (u = t.fail), 
                i(t.complete) && (s = t.complete);
                var f = 0, d = "";
                t.success = function() {
                    if (o || (o = r()), c) {
                        var e = r();
                        c.apply(this, arguments);
                        var n = r() - e;
                        0 < n && (f += n);
                    }
                }, t.fail = function(e) {
                    if (d = e.errMsg, o || (o = r()), u) {
                        var n = r();
                        u.apply(this, arguments);
                        var t = r() - n;
                        0 < t && (f += t);
                    }
                }, t.complete = function(e) {
                    if (l.fr || (l.fr = r()), o || (o = r()), s) {
                        var c = r();
                        s.apply(this, arguments);
                        var i = r() - c;
                        0 < i && (f += i);
                    }
                    var u = {
                        n: t.url,
                        m: t.method && t.method.toUpperCase() || "GET",
                        cb: f,
                        e: o - a,
                        req: n(t.data).length,
                        res: n(e.data).length,
                        st: e.statusCode || 0,
                        f: o - a,
                        g: "",
                        h: e.header ? n(e.header).substring(0, 2e3) : "",
                        o: a - h.onLaunch,
                        oe: 0,
                        p: "",
                        rd: 0
                    };
                    d && (u.errMsg = d), m.push(Object.assign({}, u));
                }, a = r();
            }
            return e.apply(this, arguments);
        }
    });
}(), _);

module.exports = E;